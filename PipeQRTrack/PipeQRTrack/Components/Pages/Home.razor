@page "/"

@inject ISnackbar Snackbar
@inject BasicService BasicService
@rendermode InteractiveServer
@attribute [StreamRendering]

<PageTitle>Home</PageTitle>
<MudStack Spacing="8">
<MudContainer MaxWidth="MaxWidth.Small">
    <MudCard Elevation="3" Class="mt-6">
        <MudCardHeader>
            <MudText Typo="Typo.h5">Work Order Entry</MudText>
        </MudCardHeader>
        <MudCardContent>
            <MudTextField @bind-Value="orderDetail.WorkOrder" Label="Work Order" Variant="Variant.Outlined" Margin="Margin.Dense" />
            <MudTextField @bind-Value="orderDetail.LotNumber" Label="Lot Number" Variant="Variant.Outlined" Margin="Margin.Dense" />
            <MudTextField @bind-Value="orderDetail.JointNumber" Label="Joint Number" Variant="Variant.Outlined" Margin="Margin.Dense" />
        </MudCardContent>
        <MudCardActions>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="HandleSubmit">Submit</MudButton>
        </MudCardActions>
    </MudCard>
</MudContainer>

<MudDataGrid T="WorkOrderDetail" MultiSelection="true" Hover="true" SortMode="SortMode.Single" Items="@workOrderDetails" Filterable="true">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Records</MudText>
        <MudSpacer />

    </ToolBarContent>
    <Columns>
        <SelectColumn T="WorkOrderDetail" />


        <PropertyColumn Property="x => x.WorkOrder" />
        <PropertyColumn Property="x => x.LotNumber" />
        <PropertyColumn Property="x => x.JointNumber" />
        <PropertyColumn Property="x => x.DateSubmitted" />
     

    </Columns>
    <PagerContent>
        <MudDataGridPager T="WorkOrderDetail" />
    </PagerContent>
</MudDataGrid>
</MudStack>
@code {
    List<WorkOrderDetail>? workOrderDetails = null;
    WorkOrderDetail orderDetail = new WorkOrderDetail
        {
            DateSubmitted = DateTime.Now
    };
    protected override async Task OnInitializedAsync()
    {


        workOrderDetails = await BasicService.GetAll();

    }

    private async Task HandleSubmit()
    {
        try
        {
            bool result = await BasicService.SubmitEntity(orderDetail);

            if (result)
            {
                Snackbar.Add("Form submitted successfully!", Severity.Success);
                workOrderDetails = await BasicService.GetAll();

                // Clear the form by resetting orderDetail
                orderDetail = new WorkOrderDetail
                    {
                        DateSubmitted = DateTime.Now
                    };

               
            }
            else
            {
                Snackbar.Add("Form submission failed. Please try again.", Severity.Error);
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"An error occurred: {ex.Message}", Severity.Error);
        }
    }


}